# AI人物追従ロボット
## 使用ハードウェア(モーター、ESC以外)
- Jetson Orin Nano
- Jetson Pixhawk Carrier Board
- ウェブカメラ
- RPLidar S1
- Pixhawk 6X

## 依存ソフトウェア
- Pymavlink
- Lua Script
- Docker
- Ultralytics YOLOv10

## Ardupilotの固有設定
- ThrottleとSteeringのPWM信号をそれぞれ5,7に割り当てる
- GPSを使わないため、GPSを無効化する

## 動作
- 自動動作
    - 人間を捕捉すると、その人間の近くに自動で移動
    - 人間一人に近づいて、画角に対して一定数以上の大きさになると自動で停止→人間が離れると更に追いかけてくる
- 手動操作
    - 人間がプロポで操作をすると、自動操作がキャンセルされて人間の挙動が優先される
    - 人間が操作をやめるとロボットの自動動作が再開する
- セーフティ
    - 頭部に装着した全方向回転式のLiDARセンサーで50cm以内に物体が近づくと動作を停止→離れると再開

## 各コードの役割
- `proximity_test.lua`
    - Pixhawkで動くLua Script
    - LiDARセンサーを使って常に周囲を探索、一番近い距離を認識してその距離が50cm以内になるとモードをholdに変更。50cm以上になるとモードをmanualに変更
- `RC_override.lua`
    - Pixhawkで動くLua Script
    - RC-inの1,2,3,4を常に監視し、1,3が人間操作のスロットル/ステアリングのスティック、2,4が自動操縦のスロットル/ステアリングのスティックとして認識
    - 1,3の信号が無ければ
        →2,4の信号を正として5,7に出力
    - 1,3の信号があって、2,4の信号が無ければ
        →1,3の信号を正として5,7に出力
    - 1,3の信号があって、操作をしており、2,4の信号もあれば
        →2,4の信号を無視して1,3の信号を正として5,7に出力
    - 1,3の信号があって、操作をやめて(PWMが1500付近に)いるとき
        →2,4の信号を正として5,7に出力
- `ultralytics-robot-controller.py`
    - Jetsonで動くPython Script
    - YOLOv10を使って人間を検出し、その座標をPixhawkに送信
    - Pixhawkからの座標を元に、人間の座標に向かって移動する
    - 人間が画角から消えると自動で停止、人間が再び画角に入る
    - manualモードにしてarm
    - YOLOv10を読み込み起動
    - 人間のボックスを取得し、サイズによって
        - 横幅400以上のサイズになると自動で停止
        - それ以下のサイズになると自動でRC_2にボックスの中心座標から算出した画面中央からの変量をPWM信号にして送信(ステアリング)。RC_4は固定値の435を送信(スロットル前進)
